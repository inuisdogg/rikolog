# Supabase email_leads テーブル ゼロから設定ガイド

## 概要

このガイドでは、`email_leads`テーブルを完全にクリーンな状態から設定し直します。

## 実行手順

### 準備

1. Supabaseダッシュボードを開く
   - https://supabase.com/dashboard
   - プロジェクトを選択

2. SQL Editorを開く
   - 左メニューの「SQL Editor」をクリック
   - 「New query」をクリック

### ステップ0: 現在の状態を確認

1. `supabase/00-check-current-state.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック
4. 結果を確認（テーブルが存在するか、RLSが有効か、ポリシーがあるか）

### ステップ1: 完全にクリーンアップ

1. `supabase/01-cleanup-email-leads.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック
4. 「✅ 削除完了」と表示されればOK

**重要**: このステップで既存のデータはすべて削除されます。

### ステップ2: テーブルを作成

1. `supabase/02-create-email-leads-table.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック
4. 「✅ 作成完了」と表示されればOK

### ステップ3: RLSを有効化

1. `supabase/03-enable-rls.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック
4. 「✅ RLS有効」と表示されればOK

### ステップ4: INSERTポリシーを作成（最重要）

1. `supabase/04-create-insert-policy.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック
4. 「✅ 正しく設定されている」と表示されればOK

**これが最も重要です。このステップが失敗すると、登録できません。**

### ステップ5: SELECTポリシーを作成（オプション）

1. `supabase/05-create-select-policy.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック

### ステップ6: 最終確認

1. `supabase/06-final-check.sql` の内容をコピー
2. SQLエディタに貼り付け
3. 「Run」をクリック
4. すべて「✅」と表示されれば成功

## トラブルシューティング

### エラー: "relation email_leads does not exist"

→ ステップ2を実行してください。

### エラー: "permission denied"

→ SQLエディタの右下で「Role」が「postgres」になっているか確認してください。

### エラー: "policy already exists"

→ ステップ1を実行してから、再度ステップ4を実行してください。

### ポリシーが作成されてもエラーが出る

1. ブラウザを完全にリロード（`Cmd+Shift+R` / `Ctrl+Shift+R`）
2. ブラウザのキャッシュをクリア
3. 再度登録を試す

### ステップ6で「❌」が表示される

該当するステップを再度実行してください。

## 実行後の確認

1. ブラウザを完全にリロード
2. ランディングページでメールアドレスを入力
3. 利用目的を選択（任意）
4. 「登録する」をクリック
5. エラーが出ずに「登録完了」と表示されれば成功

## 一括実行（上級者向け）

すべてのSQLを1つのファイルにまとめて実行することもできますが、エラーが出た場合の原因特定が難しくなります。ステップごとに実行することを推奨します。


